<UserControl x:Class="Dmca.App.Views.DeltaReportView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:Dmca.App.ViewModels">
    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="32,24">
        <StackPanel>
            <TextBlock Text="Delta Report" Style="{StaticResource SectionHeading}" />
            <TextBlock Text="Compare pre-execution and post-execution snapshots."
                       Foreground="#90A4AE" Margin="0,0,0,16" />

            <!-- Actions -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                <Button Content="ðŸ”„ Rescan &amp; Generate"
                        Command="{Binding RescanAndGenerateCommand}"
                        Style="{StaticResource PrimaryButton}"
                        Margin="0,0,8,0" />
                <Button Content="ðŸ“Š Generate from Existing"
                        Command="{Binding GenerateFromExistingCommand}"
                        Style="{StaticResource PrimaryButton}"
                        Margin="0,0,8,0" />
                <Button Content="ðŸ“‹ Export Markdown"
                        Command="{Binding ExportMarkdownCommand}"
                        Style="{StaticResource PrimaryButton}" />
            </StackPanel>

            <!-- Status -->
            <TextBlock Text="{Binding StatusMessage}"
                       Foreground="#FFB74D" Margin="0,0,0,16"
                       Visibility="{Binding StatusMessage, Converter={StaticResource NullToCollapsedConverter}}" />

            <!-- Rescanning indicator -->
            <TextBlock Text="Rescanning... Please wait."
                       Foreground="#4FC3F7" FontWeight="SemiBold"
                       Visibility="{Binding IsRescanning, Converter={StaticResource BooleanToVisibilityConverter}}"
                       Margin="0,0,0,16" />

            <!-- Summary -->
            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,16"
                    Visibility="{Binding Report, Converter={StaticResource NullToVisibleConverter}}">
                <StackPanel>
                    <TextBlock Text="Summary" FontWeight="Bold" FontSize="16" Foreground="White" Margin="0,0,0,8" />
                    <UniformGrid Columns="4">
                        <StackPanel Margin="0,0,16,0">
                            <TextBlock Text="Removed" Foreground="#EF5350" FontWeight="SemiBold" />
                            <TextBlock Text="{Binding Report.Summary.Removed}" Foreground="White" FontSize="24" FontWeight="Bold" />
                        </StackPanel>
                        <StackPanel Margin="0,0,16,0">
                            <TextBlock Text="Changed" Foreground="#FFB74D" FontWeight="SemiBold" />
                            <TextBlock Text="{Binding Report.Summary.Changed}" Foreground="White" FontSize="24" FontWeight="Bold" />
                        </StackPanel>
                        <StackPanel Margin="0,0,16,0">
                            <TextBlock Text="Unchanged" Foreground="#81C784" FontWeight="SemiBold" />
                            <TextBlock Text="{Binding Report.Summary.Unchanged}" Foreground="White" FontSize="24" FontWeight="Bold" />
                        </StackPanel>
                        <StackPanel>
                            <TextBlock Text="Added" Foreground="#4FC3F7" FontWeight="SemiBold" />
                            <TextBlock Text="{Binding Report.Summary.Added}" Foreground="White" FontSize="24" FontWeight="Bold" />
                        </StackPanel>
                    </UniformGrid>
                </StackPanel>
            </Border>

            <!-- Delta Items -->
            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,16"
                    Visibility="{Binding Report, Converter={StaticResource NullToVisibleConverter}}">
                <StackPanel>
                    <TextBlock Text="Changes" FontWeight="Bold" FontSize="16" Foreground="White" Margin="0,0,0,8" />
                    <DataGrid ItemsSource="{Binding Items}"
                              AutoGenerateColumns="False" IsReadOnly="True"
                              Background="Transparent"
                              RowBackground="#263238" AlternatingRowBackground="#2C3A42"
                              Foreground="White" BorderThickness="0"
                              GridLinesVisibility="Horizontal"
                              HorizontalGridLinesBrush="#37474F"
                              HeadersVisibility="Column">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100" />
                            <DataGridTextColumn Header="Type" Binding="{Binding ItemType}" Width="120" />
                            <DataGridTextColumn Header="Item ID" Binding="{Binding ItemId}" Width="200" />
                            <DataGridTextColumn Header="Display Name" Binding="{Binding DisplayName}" Width="*" />
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </Border>

            <!-- Next Steps -->
            <Border Style="{StaticResource CardStyle}" Margin="0,0,0,16"
                    Visibility="{Binding Report, Converter={StaticResource NullToVisibleConverter}}">
                <StackPanel>
                    <TextBlock Text="Next Steps" FontWeight="Bold" FontSize="16" Foreground="White" Margin="0,0,0,8" />
                    <ItemsControl ItemsSource="{Binding NextSteps}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" Foreground="#B0BEC5" Margin="0,2" TextWrapping="Wrap" />
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>

            <!-- Exported Markdown -->
            <Border Style="{StaticResource CardStyle}"
                    Visibility="{Binding ExportedMarkdown, Converter={StaticResource NullToVisibleConverter}}">
                <StackPanel>
                    <TextBlock Text="Exported Markdown" FontWeight="Bold" FontSize="16" Foreground="White" Margin="0,0,0,8" />
                    <TextBox Text="{Binding ExportedMarkdown, Mode=OneWay}"
                             IsReadOnly="True"
                             Background="#1A2327" Foreground="#B0BEC5"
                             FontFamily="Consolas" FontSize="12"
                             TextWrapping="Wrap" AcceptsReturn="True"
                             VerticalScrollBarVisibility="Auto"
                             MaxHeight="300"
                             Padding="8"
                             BorderThickness="1" BorderBrush="#37474F" />
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</UserControl>
